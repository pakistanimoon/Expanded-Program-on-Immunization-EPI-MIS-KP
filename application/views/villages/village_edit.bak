<?php 
	date_default_timezone_set('Asia/Karachi'); // CDT
	$current_date = date('Y-m-d');
	?>
<div class="container bodycontainer">
	<div class="row">
	<?php if($this -> session -> flashdata('message')){  ?><div class="alert alert-success text-center" role="alert"><strong><?php echo $this -> session -> flashdata('message'); ?></strong></div> <?php } ?>
	  <div class="panel panel-primary">
	    <ol class="breadcrumb">
	    	<ul class="breadcrumb">
				<li><a href="<?php echo base_url(); ?>">Home</a><span class="divider"></span></li>
				<li class="active"></li>
			</ul>
	    </ol> 
    	<div class="panel-heading">Update Village</div>
  	  	<div class="panel-body">
    	   <form name="dataform" id="dataform" action="<?php echo base_url();?>Villages/village_save" method="post" enctype="multipart/form-data" class="form-horizontal form-bordered" onSubmit="">
				<div class="row">
	    		   <div class="form-group">
	    		   	<input type="hidden" name="added_date" id="added_date" value="<?php echo $current_date; ?>" class="form-control">
					  	<label class="col-xs-2 col-xs-offset-1 control-label">District:</label>
						<div class="col-xs-3">
							 <?php 
								$distcode = $this-> session-> District;
								echo get_District_Name($distcode); 
							?> 
							<input type="hidden" name="distcode" value="<?php echo $distcode; ?>">							
						</div>
						<label class="col-xs-2 control-label">Tehsil:</label>
						<div class="col-xs-3">
							<?php
								$distcode = $this-> session-> District; 
								$query="SELECT tcode, tehsilname(tcode) as tehsil from tehsil where distcode='{$distcode}'";
								$result = $this->db->query($query)->result_array();
							?>
							<select class="form-control" name="tcode" id="ticode" required="required">
								
								<option value="<?php echo $data[0]['tcode']; ?>"><?php echo $data[0]['tehsil']; ?></option>
							
							<!--<?php foreach ($result as $key => $value) { ?>
								<option value="<?php echo $value['tcode'] ?>"><?php echo $value['tehsil'] ?></option>
								<?php } ?>-->
							</select>							
						</div>
  					  
				   </div>
				</div>
				<div class="row">
					<div class="form-group">
							<label class="col-xs-2 col-xs-offset-1 control-label">Union Council:</label>
							<div class="col-xs-3">
								<select name="uncode" id="unicode" required="required" class="form-control">
									<option value="<?php echo $data[0]['uncode']; ?>"><?php echo $data[0]['unioncouncil']; ?></option>
								</select>
							</div>
							<label class="col-xs-2 control-label">Village Name:</label>
						  	<div class="col-xs-3">
							 	<input required="required" name="village_name" id="village_name" placeholder="Village Name" class="form-control" class="form-control" value="<?php echo $data[0]['village']; ?>">
							 	<!-- <input type="hidden" required name="facode" id="facode" readonly="readonly" placeholder="Health Facility Code" class="form-control"> -->
						  	</div>				
					</div>
				</div>
				<div class="row">
	    		   <div class="form-group">
	    		   	<label class="col-xs-2 col-xs-offset-1 control-label">Village Code:</label>
					  	<div class="col-xs-3">
							<input name="vcode" id="vcode" placeholder="Village Code" class="form-control text-center" readonly="readonly" required="required" value="<?php echo $data[0]['vcode']; ?>" >
					  	</div>
  					  	<label class="col-xs-2 control-label">Target Population:</label>
					  	<div class="col-xs-3">
							<input required="required" name="population" id="population" placeholder="Population" class="form-control numberclass" class="form-control" value="<?php echo $data[0]['population']; ?>">
					  	</div>
				   </div>
				</div>				
				<div class="row">
					<div class="form-group">
							<label class="col-xs-2 col-xs-offset-1 control-label">Population < 1 Year:</label>
					  	<div class="col-xs-3">
							<input required="required" name="population_less_year" id="population_less_year" placeholder="less then 1 year" class="form-control numberclass" class="form-control" value="<?php echo $data[0]['population_less_year']; ?>">
					  	</div>
						<label class="col-xs-2  control-label">Postal Address:</label>
					  	<div class="col-xs-3">
							<input required="required" name="postal_address" id="postal_address" placeholder="Postal Address" class="form-control" class="form-control"  value="<?php echo $data[0]['postal_address']; ?>">
					  	</div>
						
					</div>
				</div>
				<input type="hidden" name="edit" value="edit">
				<hr>
				<div class="row">
					<div class="col-xs-7" style="margin-left:67.5%;" >
						<button type="submit" value="1" name="submit" class="btn btn-md btn-success"><i class="fa fa-floppy-o"></i> Save Form </button>
						<button type="reset" class="btn btn-md btn-success"><i class="fa fa-repeat"></i> Reset Form </button>
						<a href="<?php echo base_url();?>Villages/village_list" class="btn btn-md btn-success"><i class="fa fa-times"></i> Cancel </a>
					</div>
				</div>
			</form>			
  		</div> <!--end of panel body-->
 	</div> <!--end of panel panel-primary-->
</div><!--end of row-->	
</div><!--End of page content or body contaier-->

<script  type="text/javascript">
	$(window).on('load', function() {
		if($('#tcode :selected').val() == '0'){
			$('#tcode :selected').val('');
		}
	});
		$( "#population_less_year" ).change(function() {
		var population = $('#population').val();
		var population_less_year = $('#population_less_year').val();
		if(population < population_less_year){
		alert('Target Population Cannot be Greater than Total Population');
    		$('#population_less_year').val('');
    		$('#population_less_year').css('border-color','red');
		// $('#population').val('');
		// $('#postal_address').val('');
		}else{
			$('#population_less_year').css('border-color','');
		}		
	});
	function checkCode(num) {
		var regexp = /[0-9]{2}/;
		var valid = regexp.test(num);
		return valid;
	}
	$(document).on('change','#ticode', function(){
		var tcode = this.value;
		//to get ucs of selected distcrict
		if(tcode != 0) {
		  $.ajax({
				type: "POST",
				data: "tcode="+tcode,
				url: "<?php echo base_url(); ?>Ajax_red_rec/getUnC/",
				success: function(result){
					$('#unicode').html(result);
				}
			});
		}
		else{
			$('#unicode').html('');
			//it doesn't exist
		}						
	});	
	// <?php if(!$this->input->get('facode')){ ?>
	//$(document).on('change','#ticode', function(){
/* 	$('#village_name').on('blur' , function (){
		var uncode = $('#unicode').val();
			$.ajax({
			type: "GET",
			data: "uncode="+uncode,
			url: "<?php echo base_url(); ?>Ajax_red_rec/generateCode",
			success: function(result){
				$('#vcode').val(result);
			}
		});
	}); */
	$(document).on('change', '#unicode', function(){
		var unicode = this.value;
		if(unicode != ""){
			$('#vcode').val('');
			$('#village_name').val('');
			// $('#population').val('');
			// $('#postal_address').val('');
		}		
	});
// <?php } ?>
</script>